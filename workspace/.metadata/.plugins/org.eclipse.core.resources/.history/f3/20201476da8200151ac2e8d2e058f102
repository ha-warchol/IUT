import java.sql.*;
public class OutilsJDBC {
	public static Connection openConnection (String url) {
		Connection co=null;
		try {
			Class.forName("oracle.jdbc.driver.OracleDriver");
			co= DriverManager.getConnection(url);
		}
		catch (ClassNotFoundException e){
			System.out.println("il manque le driver oracle");
			System.exit(1);
		}
		catch (SQLException e) {
			System.out.println("impossible de se connecter a l'url : "+url);
			System.exit(1);
		}
		return co;
	}
	public static ResultSet exec1Requete (String requete, Connection co, int type){
		ResultSet res=null;
		try {
			Statement st;
			if (type==0){
				st=co.createStatement();}
			else {
				st=co.createStatement(ResultSet.TYPE_SCROLL_INSENSITIVE, 
						ResultSet.CONCUR_READ_ONLY);
			};
			res= st.executeQuery(requete);
		}
		catch (SQLException e){
			System.out.println("Probleme lors de l'execution de la requete : "+requete);
		};
		return res;
	}

	public static void closeConnection(Connection co){
		try {
			co.close();
			System.out.println("Connexion fermee!");
		}
		catch (SQLException e) {
			System.out.println("Impossible de fermer la connexion");
		}	
	}
	public static void main(String[] args) throws SQLException{
		
		String url="jdbc:oracle:thin:dha/YtJZKLHU7URU@oracle.iut-orsay.fr:1521:etudom";
		Connection co = openConnection(url);
		/* //Question 1
		String requete = "SELECT * FROM ens2004.FILM";
		ResultSet rs = exec1Requete (requete, co , 1);

		while(rs.next() && i < 10){
			String titre = rs.getString("Titre");
			int numFilm = rs.getInt("numFilm");
			int realisateur = rs.getInt("Realisateur");
			System.out.println("Titre du film n°"+numFilm+" : "+titre+ " par le realisateur n°"+realisateur);
			i++;
		}


		//Question 3
		String requete2 = "SELECT * FROM ens2004.Individu WHERE nomIndividu='FONDA'";
		ResultSet rs2 = exec1Requete(requete2, co, 1);
		System.out.println("Personnes possedant le nom FONDA : ");
		while(rs2.next()){
			String prenom = rs2.getString("prenomIndividu");
			System.out.println(prenom);
		}*/
		
		//Question 5
		String acteur;
		int i = 1;
		System.out.println("Entrer le nom d'un acteur :");
		acteur = saisie.chaine().toUpperCase();
		String requete = "SELECT DISTINCT prenomIndividu FROM ens2004.Individu, ens2004.Acteur WHERE ens2004.individu.numIndividu=ens2004.acteur.numindividu AND NomIndividu='"+acteur+"'";
		
		ResultSet rs = exec1Requete(requete, co , 1);
		while(rs.next()){
			String prenom = rs.getString("prenomIndividu");
			System.out.println(i+" "+prenom+ " "+acteur);
			i++;
		}
		//Choix acteur
		System.out.println("Votre choix : ");
		int choixacteur = saisie.entier();
		rs.absolute(choixacteur);
		String prenomChoix = rs.getString("prenomIndividu");
		System.out.println("Vous avez choisi : "+prenomChoix+" "+acteur);
		
		//Choix film
		String requete2 = "SELECT Titre FROM ens2004.film f, ens2004.acteur a, ens2004.individu i WHERE f.numfilm = a.numfilm AND i.numindividu = a.numindividu AND i.nomIndividu='"+acteur+"' AND prenomIndividu='"+prenomChoix+"' ORDER BY numFilm";
		ResultSet rs2 = exec1Requete(requete2, co , 1);
		System.out.println("Il a joué dans : ");
		i=1;
		while(rs2.next()){
			String titre = rs2.getString("Titre");
			System.out.println(i+" "+titre);
			i++;
		}
		System.out.println("Votre choix :");
		int choixfilm = saisie.entier();
		rs2.absolute(choixfilm);
		String film = rs2.getString("Titre");
		System.out.println("Vous avez choisi : "+film);
		
		//Exemplaires du film
		String requete3 = "SELECT numExemplaire FROM ens2004.exemplaire ex, ens2004.film f WHERE f.numFilm = ex.numFilm AND Titre='"+film+"'";
		ResultSet rs3 = exec1Requete(requete3, co, 1);
		System.out.println("Voici les exemplaires de ce film :");
		while(rs3.next()){
			String numEx = rs3.getString("numExemplaire");
			System.out.println(numEx);
		}
		closeConnection(co);
	}
}